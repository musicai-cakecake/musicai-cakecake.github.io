<!DOCTYPE html>
<html lang="en-us" xmlns:audio="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.16-DEV" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
<link rel="stylesheet" href="../css/normalize.css">
<link rel="stylesheet" href="../css/skeleton.css">
<link rel="stylesheet" href="../css/custom.css">
<link rel="alternate" href="index.xml" type="application/rss+xml" title="Music AIGC">
<!-- <link rel="shortcut icon" href="favicon.png" type="image/x-icon" /> -->

<style>
    .container {
        display: flex;
        justify-content: center;
    }

</style>

<!--<style>-->
<!--    img {-->
<!--       width: 50%;-->
<!--       height: auto;-->
<!--    }-->
<!--</style>-->

<title>POP-Diffuseq music generation samples</title>
</head>
<body>

<div class="container">
    <header role="banner"></header>
    <main role="main">
        <article itemscope itemtype="https://schema.org/BlogPosting">
            <h1 class="entry-title" itemprop="headline">Pop-Diffuseq paper supplement and generated samples</h1>
            <section itemprop="entry-text">

                <p style="font-size:20px;">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Welcome to the supplement page!
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;POP-Diffuseq, the digital music content infilling in Midi format. The audio samples on this page are exported from Apple Logic build-in sounds.
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Implement code are available on Github:
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://github.com/musicai-cakecake/pop-diffuseq
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The trained models, datasets and all unfiltered samples can be downloaded in Google Drive:
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://drive.google.com/drive/folders/1OWI_sfYmYn2gB13KccO9kkXCP2x8Z-1x?usp=drive_link
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Our MIDI dataset PopBand3k are also in this link.
                </p>

                <div class="container">
                    <img src="text-to-scores.jpg" alt="MIDI generation guided by musical terms." width="50%" height="50%">
                </div>
                <p style="text-align:center;font-size:20px">
                    Figure 1. Pop-Diffuseq: Conditional pop music accompaniment generation. POP-Diffuseq can create pop music scores
                    <br>guided by musical terms(prompts) such as instrument and tempo, and is qualified to any-to-any instruments generation.
                </p>

                <h2>Method and pipeline model configurations</h2>
                <p style="font-size:20px;">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We present POP-Diffuseq, a pop music infilling model based on classifier-free discrete diffusion.
                    In this work, the midi content (such pitch,onset,duration etc.) is encoded in a syntax pattern of Structure-Aligned (SA) tensor,
                    where rows represent note (chord) units and columns express the attributes of the notes (chords).
                    The encoded tensors will be trained and inferred by the deep learning model.
                    Of course, the music score (midi file) is decoded from inferred tensor via the Structure-Aligned (SA) grammar pattern.
                    The pipeline is shown in Figure 2.
                    This approach is called “representation learning” in textual and symbolic music research.
                </p>
                <div class="container">
                    <img src="picture/pipeline.png" alt="Pipeline." width="80%" height="80%">
                </div>
                <p style="text-align:center;font-size:20px">
                    Figure 2. Method and pipeline of training and inference.
                </p>
                <p style="font-size:20px;">
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The greatest value of this infilling method is to support the human-intelligent interaction of Artificial Intelligence Generated Content (AIGC).
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Some typical scenarios are shown in Figure 3.
                </p>

                <div class="container"><img src="interaction.jpg" alt="Interactive generation by Pop-diffuseq." width="35%" height="35%"></div>
                <p style="text-align:center;font-size:20px">Figure 3. Interactive generation by Pop-diffuseq.</p>

<!--<img src="‎text_to_score.png" alt="text to score" width="40%" height="40%">-->

<!--<p style="font-size:18px;"> POP-Diffuseq can create pop music scores guided by musical terms(prompts) such as instrument and tempo, and is qualified to any-to-any instruments generation.</p>-->


<h2>Piano and chord conditioned melody generation samples (accompaniment to melody)</h2>
<p style="font-size:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generate melody based on a given piano track. </p>
<h3>Data set: Pop909. </h3>

<table><thead>
<tr>
<th style="text-align: center">Samples</th>
<th style="text-align: center">Input</th>
<th style="text-align: center">AI Generation</th>	
<th style="text-align: center">Human Ground truth</th>
</tr></thead><tbody>
<tr>
<td>Sample 1</td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-1/input-1.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-1/Melody-Diffuseq-sample-1-generation.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-1/Melody-Diffuseq-sample-1-real.mp3"/>Your browser does not support the audio element.</audio></td>
</tr>
<tr>
<td>Sample 2</td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-2/input-2.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-2/Melody-Diffuseq-sample-2-generation.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-2/Melody-Diffuseq-sample-2-real.mp3"/>Your browser does not support the audio element.</audio></td>
</tr>
<tr>
<td>Sample 3</td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-3/input-3.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-3/Melody-Diffuseq-sample-3-generation.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-3/Melody-Diffuseq-sample-3-real.mp3"/>Your browser does not support the audio element.</audio></td>
</tr>
<tr>
<td>Sample 4</td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-4/input-4.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-4/Melody-Diffuseq-sample-4-generation.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-4/Melody-Diffuseq-sample-4-real.mp3"/>Your browser does not support the audio element.</audio></td>
</tr>
<tr>
<td>Sample 5</td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-5/input-5.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-5/Melody-Diffuseq-sample-5-generation.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-5/Melody-Diffuseq-sample-5-real.mp3"/>Your browser does not support the audio element.</audio></td>
</tr>
<tr>
<td>Sample 6</td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-6/input-6.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-6/Melody-Diffuseq-sample-6-generation.mp3"/>Your browser does not support the audio element.</audio></td>
<td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-6/Melody-Diffuseq-sample-6-real.mp3"/>Your browser does not support the audio element.</audio></td>
</tr>
<tr>
  <td>Sample 7</td>
  <td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-7/input-7.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-7/Melody-Diffuseq-sample-7-generation.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/melody-generation-samples/sample-7/Melody-Diffuseq-sample-7-real.mp3"/>Your browser does not support the audio element.</audio></td>
</tr>
</tbody>
</table>

<h2>Prompts and chord conditioned accompaniment generation samples (prompts and melody to accompaniment)</h2>
                <p style="font-size:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Generate band accompaniment from specified instruments and tempo prompts.

<!--                    <br> All our hundreds of AI-generation midis without filtrate could be available from web.-->
                </p>

<h3>Data set: PopBand3k</h3>
<table><thead>
  <tr>
  <th style="text-align: center">Samples    </th>
  <th style="text-align: center">Input prompts    </th>
  <th style="text-align: center">Input melody</th>
  <th style="text-align: center">AI generation</th>
  </tr></thead>
    <tbody>
  <tr>
  <td style="text-align: center">Sample 1 &nbsp;</td>
  <td style="text-align: center">Guitar, bass, ensemble, drum, percussive, Tempo-Andante &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/80-popband-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/80-popband-gen.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
  <td style="text-align: center">Sample 2 &nbsp;</td>
  <td style="text-align: center">Ethnic, bass, guitar, drum, synth-pad, Tempo-Andante &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/334-popband-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/334-popband-gen.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
      <td style="text-align: center">Sample 3 &nbsp;</td>
      <td style="text-align: center">Brass, bass, synth-pad, drum, ensemble, Tempo-Moderato &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/353-popband-melody.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/353-popband-gen.mp3"/>Your browser does not support the audio element.</audio></td>
 </tr>
  <tr>
      <td style="text-align: center">Sample 4 &nbsp;</td>
      <td style="text-align: center">Strings, bass, guitar, piano, Tempo-Andante &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/18-popband-melody.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/18-popband-gen.mp3"/>Your browser does not support the audio element.</audio></td>
 </tr>
  <tr>
      <td style="text-align: center">Sample 5 &nbsp;</td>
      <td style="text-align: center">Guitar, bass, piano, drum, organ, Tempo-Allegro &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/126-popband-melody.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/126-popband-gen.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  </tbody>
  </table>

<h3>Data set: LMD &nbsp; Masking strategy: high yield </h3>
<table><thead>
  <tr>
  <th style="text-align: center">Samples    </th>
  <th style="text-align: center">Input prompts    </th>
  <th style="text-align: center">Input melody</th>
  <th style="text-align: center">AI generation</th>
  </tr></thead>
    <tbody>
  <tr>
  <td style="text-align: center">Sample 1 &nbsp;</td>
  <td style="text-align: center">Electric guitar, bass, drum, Tempo-Moderato &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/0-lmd-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/0-lmd-gen.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
  <td style="text-align: center">Sample 2 &nbsp;</td>
  <td style="text-align: center">Brass, bass, drum, percussive, Tempo-Andante &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/6-lmd-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/6-lmd-gen-quality.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
      <td style="text-align: center">Sample 3 &nbsp;</td>
      <td style="text-align: center">Acoustic guitar, bass, drum, piano, Tempo-Allegro &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/16-lmd-melody-quality.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/16-lmd-gen-quality.mp3"/>Your browser does not support the audio element.</audio></td>
 </tr>
  <tr>
      <td style="text-align: center">Sample 4 &nbsp;</td>
      <td style="text-align: center">Ensemble, synth pad, percussive, Tempo-Moderato &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/17-lmd-melody.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/17-lmd-gen.mp3"/>Your browser does not support the audio element.</audio></td>
 </tr>
 <tr>
      <td style="text-align: center">Sample 5 &nbsp;</td>
      <td style="text-align: center">Ensemble, bass, drum, Tempo-Andante &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/14-originality-melody.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/14-originality-gen.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
  <td style="text-align: center">Sample 6 &nbsp;</td>
  <td style="text-align: center">Acoustic guitar, electric guitar, bass, percussive, Tempo-Andante &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/15-originality-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/15-originality-gen.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
      <td style="text-align: center">Sample 7 &nbsp;</td>
      <td style="text-align: center">Brass, bass, percussive, Tempo-Allegro &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/35-originality-melody.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/35-originality-gen.mp3"/>Your browser does not support the audio element.</audio></td>
 </tr>
      <tr>
      <td style="text-align: center">Sample 8 &nbsp;</td>
      <td style="text-align: center">electric guitar, bass, percussive, Tempo-Allegro &nbsp;</td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/38-originality-melody.mp3"/>Your browser does not support the audio element.</audio></td>
      <td><audio controls="controls" ><source src="Samples/accompaniment-generation-samples/38-originality-gen.mp3"/>Your browser does not support the audio element.</audio></td>
 </tr>
  </tbody>
  </table>

<h3>Contrast</h3>
<table>
    <thead>
  <tr>
  <th style="text-align: center">Samples</th>
  <th style="text-align: center">Input melody</th>
  <th style="text-align: center">POPMAG</th>
  <th style="text-align: center">Our Pop-Diffuseq</th>
  </tr>
  </thead>
    <tbody>
  <tr>
  <td style="text-align: center">Sample 1 &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/1-contrast-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/1-popmag.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/1-contrast-pop-diffuseq-lmd.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
  <td style="text-align: center">Sample 2 &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/2-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/2-popmag.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/2-contrast-pop-diffuseq-lmd.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  <tr>
  <td style="text-align: center">Sample 3 &nbsp;</td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/3-melody.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/3-popmag.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/ContrastExperiment-samples/3-contrast-pop-diffuseq-lmd.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  </tbody>
  </table>

<h3>Interactive generation</h3>
<table>
<thead>
  <tr>
  <th style="text-align: center">Original music</th>
  <th style="text-align: center"> Fill-in drum</th>
  </tr>
  </thead>
    <tbody>
  <tr>
  <td><audio controls="controls" ><source src="Samples/interaction-samples/33-no-drum.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/interaction-samples/33.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  </tbody>
    </table>

    <table>
<thead>
  <tr>
  <th style="text-align: center">Original music</th>
  <th style="text-align: center">Original guitar and bass</th>
  <th style="text-align: center">AI modified guitar and bass</th>
  <th style="text-align: center">Modified music</th>
  </tr>
  </thead>
    <tbody>
  <tr>
  <td><audio controls="controls" ><source src="Samples/interaction-samples/1-origin-full.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/interaction-samples/1-origin.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/interaction-samples/1-remix-guitar-bass.mp3"/>Your browser does not support the audio element.</audio></td>
  <td><audio controls="controls" ><source src="Samples/interaction-samples/1-remix-full.mp3"/>Your browser does not support the audio element.</audio></td>
  </tr>
  </tbody>
    </table>

<h2>Dataset and preprocessing</h2>
<p style="font-size:20px;"> &nbsp;&nbsp;&nbsp;&nbsp;As stated in the paper, We contribute a pop band MIDI dataset MidiPopBand3k and a modified LMD-matched(LMD) dataset, both of which were used for experiments.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;MidiPopBand3k is a well-chosen collection of 1000 pop MIDI music carefully selected by our musicians. All 1K raw MIDI files in the dataset are obtained from free Internet sources.
    We then split the music into shorter pieces, resulting in 3K MIDI files. Although the length of music in small clips is shortened, it is sufficient for various music AI tasks.
    The music collection is carefully selected based on a series of criteria:
    <br>&nbsp;&nbsp;&nbsp;&nbsp;(1) Pop band music. The music must include a vocal melody track and at least three different instrumental accompaniments. In other words, music has at least four parts.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;(2) The entire music must be long enough to be divided into three segments, each of at least 500 notes.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;(3) The category of musical instrument are distinct enough to be identified in all tracks.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;(4) Musical styles range from classic pop, rock, jazz and country etc. Try to avoid rap and electronic music as they are not easy to study together.
    Oriental music (including Chinese pop, J-pop, K-pop and a small amount of Indian pop) accounts for a larger proportion.
<p style="font-size:20px;"> &nbsp;&nbsp;&nbsp;&nbsp;Our musicians manually annotated the instrument category on each track and proofread the tempo of all the music. MidiPopBand3k is suitable for various AI tasks, including music generation, understanding and recommendation.
    We make MidiPopBand3k freely available to help research in the field of music artificial intelligence. The design of instrument categories and tempo will be introduced in subsequent chapters.
<p style="font-size:20px;"> &nbsp;&nbsp;&nbsp;&nbsp;LMD-matched is a POP subset of Lakh MIDI dataset(colinraffel.com/projects/lmd), the subset have been matched to entries in the Million Song Dataset.
    The style of LMD-aligned include folk pop, metal pop, Rock and roll, jazz pop, traditional pop etc., most music belong to western pop music.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;The raw MIDI files are very coarse, have much of mistake in music content, such as no melody, superposition of notes, unaligned beat, empty track or merged track, no instrument label etc. A poor data set will seriously affect the training quality of the model.
    Some of other AI music works not released the processed midi samples or artificially trim the MIDI data, however, manually processing MIDI content on big data is impossible. For general AI tasks, We contribute a series of algorithms for automatically preprocessing and trimming MIDI content based on music theory.
    These implementation tools are suitable for most types of music and can easily expand big data.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;Following the same screening criteria and processing procedures as MidiPopBand3k, we finally filtered out a modified LMD dataset of 14K+ MIDI files.

                <h2>Model configurations</h2>
                <p style="font-size:20px;">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In order to fairly demonstrate the contributions of the representation, attention algorithm and framework proposed in this paper,
                    the bidirectional encoder structures of our Pop-Diffuseq and Diffuseq comparison group both adopt the benchmark configuration ’bert-base-uncased’ of Hugging-face.
                    Moreover, the hyperparameters and training data are also required to be exactly the same.
                    We set the length of a sequence to 512, which contains 125 notes, 7 prompts and 5 special symbols.
                    4 sequences are spliced into one piece of music. The hidden size of encoder layers are 768, which is assigned to 12 attention heads.
                    Four output linear layers are shared parameters(actually reuse one dense network in program coding).
                    We employ many accelerated approaches for both the training and sampling stages, such as the fast ODE solver(DPM-solver) for diffusion model, FP16 for GPU acceleration and AI platform Pytorch2.0.
                    The diffusion steps in training stage are 2000, 10 steps in decoding stage.
                    Sqrt noise schedule are used in training stage.
                    We train Pop-Diffuseq model and comparison group on 4 NVIDIA 4090 GPUs, with batch size of 40 sequence. It takes 40k steps for training until convergence.
                </p>

<h2>Supplement for music representation</h2>
<h3> Instrument </h3>
<p style="font-size:20px;"> &nbsp;&nbsp;&nbsp;&nbsp;We adopt all 16 instrument categories according to the MIDI protocol, then divide the guitar into acoustic guitar and electric guitar, and finally the vocal melody track, a total of 18 categories.
    <br>All existing musical instruments and sounds are classified into these 18 categories: </p>

<table><thead>
<tr>
<th style="text-align: center">Instrument Category &nbsp; &nbsp;</th>
<th style="text-align: center">Timbre Cases (program number) &nbsp; &nbsp;</th>
<th style="text-align: center">Instrument Category &nbsp; &nbsp;</th>
<th style="text-align: center">Timbre Cases (program number) &nbsp; &nbsp; &nbsp;</th>
</tr></thead>
    <tbody>
<tr>
<td>Melody</td>
<td>grand piano(0)</td>
<td>Chord progression</td>
<td>grand piano(0)</td>
</tr>
<tr>
<td>Piano</td>
<td>grand piano(0), Honky-tonk piano(3)</td>
<td>Chromatic percussion</td>
<td>marimba(12), xylophone(13)</td>
</tr>
<tr>
<td>Organ</td>
<td>accordion(21), church organ(19)</td>
<td>Bass</td>
<td>acoustic bass(32), electric bass(33)</td>
</tr>
<tr>
<td>Acoustic guitar</td>
<td>nylon(24), steel(25)</td>
<td>Electric guitar</td>
<td>jazz(26), overdriven(29)</td>
</tr>
<tr>
<td>Strings</td>
<td>violin(40), string ensemble(48)</td>
<td>Ensemble</td>
<td>synth strings(51), string ensemble(48)</td>
</tr>
<tr>
<td>Brass</td>
<td>Trumpet(56), brass section(61)</td>
<td>Reed</td>
<td>bassoon(70), clarinet(71)</td>
</tr>
<tr>
<td>Pipe</td>
<td>flute(73), piccolo(72)</td>
<td>Lead</td>
<td>square(80)</td>
</tr>
<tr>
<td>pad</td>
<td>choir(91)</td>
<td>Effects</td>
<td>echoes (102)</td>
</tr>
<tr>
<td>Ethnic</td>
<td>sitar(104), shamisen(106)</td>
<td>Percussion</td>
<td>synth drum(118), taiko(116)</td>
</tr><tr>
<td>Drum</td>
<td>drum kit(0, is_drum=True)</td>
<td>Unknow</td>
<td>grand piano(0)</td>
</tr>
</tbody>
</table>

<p style="font-size:20px;">&nbsp;&nbsp;&nbsp;&nbsp;There are significant differences in the note distribution of multiple instruments. We recommend proactively telling the model which instruments need to be created, and during the training phase, a strong relationship between the instrument label and note events must be established.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;In our experiments with the official SymphonyNet implement, asking the model to grasp note distribution without condition in a multi-instrument dataset was awkward(such the characteristic of strings, ensemble and lead was ambiguous), and using the network to reclassify instruments on the generated tracks produced secondary deviation.
    <br>&nbsp;&nbsp;&nbsp;&nbsp;Therefore, according to our extensive experiments, it is necessary to make the instrument labels appear repeatedly in the representation sequence during the model training process, and preferably as input conditions during the inference process.
</p>

<h3> Tempo </h3>
<p style="font-size:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Simply put, tempo determines how quickly the score is played, it is a significant global mark on score. The detailed explanation can be found at https://en.wikipedia.org/wiki/Tempo
    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tempo affects the distribution of note onset times and durations, thus having a powerful influence on the emotion and mood. Therefore, we recommend using tempo as input condition for generation rather than letting the AI model choose on its own.
    We divide the Tempo into 5 types according to bpm range:
</p>
<table><thead>
  <tr>
  <th style="text-align: center">Tempo Type &nbsp; &nbsp;</th>
  <th style="text-align: center">BPM Range</th>
  </tr></thead>
    <tbody>
  <tr>
      <td style="text-align: center">largo</td>
      <td style="text-align: center"><66</td>
  </tr>
  <tr>
      <td style="text-align: center">andante</td>
      <td style="text-align: center">66-108</td>
  </tr>
  <tr>
      <td style="text-align: center">moderato</td>
      <td style="text-align: center">108-126</td>
 </tr>
  <tr>
      <td style="text-align: center">allegro</td>
      <td style="text-align: center">126-168</td>
 </tr>
  <tr>
      <td style="text-align: center">presto</td>
      <td style="text-align: center">>168</td>
  </tr>
  </tbody>
  </table>

<h3> Chord </h3>
<p style="font-size:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In Pop-Diffuseq, Chord progression is the timeline of entire musical scores. Chords include 12 root notes and 9 types:
    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Major triad, Minor triad, Augmented triad, Diminished triad, Dominant seventh, Major seventh, Minor seventh, Half-diminished seventh.
</p>


<h3> Representation demo</h3>
<p style="font-size:20px;">
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A multi-instrument score is shown in Figure 4, and its corresponding representation sequence is below the score.
    </p>

<div class="container">
    <img src="score-demo.png" alt="score demo" width="40%" height="40%">
</div>
<!--<img src="score-demo.png" alt="score demo" width="35%" height="35%">-->
<!--<p style="text-align:center;">Fig.2. Music score.</p>-->
<p style="text-align:center;font-size:20px">Figure 4. Music score.</p>

<p style="font-size:20px;">
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Music content sequence W<sup>m</sup> = [[chord, time0, chord-0-, reserve], [melody, time0, C5, dur2], [melody, time4, C5, dur2], [melody, time8, G5, dur2], [melody, time12, G5, dur2], [bass, time0, C4, dur8], [strings, time0, E4, dur2],
[strings, time4, G4, dur2], [strings, time8, E5, dur2], [strings, time12, C5, dur2],
<br>[chord, time16, chord-2-m, reserve], [melody, time0, A5, dur2], [melody, time4, A5, dur2], [melody, time8, G5, dur4], [melody, time16, F5, dur2], [melody, time20, F5, dur2], [melody, time24, E5, dur2], [melody, time28, E5, dur2], [bass, time0, F4, dur4],
[bass, time8, C4, dur4], [bass, time16, F4, dur4], [bass, time24, C4, dur4], [strings, time0, D5, dur2], [strings, time4, D5, dur2], [strings, time8, C5, dur4], [strings, time16, D5, dur3], [strings, time22, D5, dur1], [strings, time24, C5, dur3], [strings, time30, C5, dur1],
<br>[chord, time32, chord-3-m7, reserve], [melody, time0, D5, dur2], [melody, time4, D5, dur2], [bass, time0, G4, dur4], [strings, time0, D5, dur2], [strings, time4, E5, dur2],
<br>[chord, time8, chord-0-, reserve], [melody, time0, C5, dur4], [bass, time0, C4, dur4], [bass, time0, E4, dur4], [bass, time0, G4, dur4], [strings, time0, C5, dur4]]
</p>

    <h2>Supplement for Loss function</h2>
    <div class="container">
        <img src="picture/loss.png" alt="input embedding and output module" width="40%" height="40%">
    </div>
                <p style="font-size:20px;">
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The definitions of functions and parameters are the same as those of the classic text diffusion model(Diffuseq, Difformer).
                    The parameters x and y are common variables, they can be different things in different build tasks.
                    In the controllable filling and accompaniment generation task, the x and y are c (condition） and m (music), respectively, in no particular order.

</p>



    <h2>Input content embedding and output module</h2>
                <p style="font-size:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    Some notable differences between our model and GPT-like textual models are the contextual (music content) embeddings and the output module.
                    <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    As shown in Figure 5 (left), Embedding is used to convert integer event tokens into floating-point embedding vectors.
                    The size of 3D embedding tenser for a piece of music is [𝑖, 𝑗, 𝑑], where 𝑖, 𝑗, 𝑑 are the length of notes plus prompts, attributes and embedding vector.
                    <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;At the end of framework, we design an output module that combines multiple linear layers and classification masks for structurally aligned tensors.
                    This module is used to map the encoder hidden state to a certain attribute category absolutely correctly.
                    For example, the hidden vector belonging to the pitch-dimension(third column) in the tensor must be mapped to one of 72 categories of pitch, and not be classified into duration or other categories.
                    <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The output module is shown in figure 5 (right).
                    Linear layer (colored trapezoids utilize a fully connected network to convert a hidden vector into an probabilities sequence of the same length as the dictionary(vocab size),
                    which reflects the probability scores of the tokens.
                    We divide hidden state tensor into 4 blocks by column(attributes), and arrange 4 linear layers to predict their respective probability scores.
                    The cross-modal information is concatenated with the first block (instrument attributes) and fed into the first linear layer.
                    Obtained probabilities is then multiplied bitwise by a 0-1 masking sequence 𝑀𝑎𝑠𝑘 𝑗 .
                    Tokens with probability scores set to 0 will not be selected.
                    Finally, the predictions are concatenated based on the grammatical structure of the representation.
                </p>
                <div class="container">
                    <img src="picture/emb.jpg" alt="input embedding and output module" width="40%" height="40%">
                </div>
                <p style="text-align:center;font-size:20px">Figure 5. Input content embedding method and output module.</p>



    <h2>Objective evaluation supplement</h2>
                <p style="font-size:20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(A) Model perplexity (PPL).
                    We calculate token-wise PPL on the Validation set (different with train set).
                    The lower the PPL index, the better.
                    In all the Diffuseq-based comparison sets, we employ the same hyperparameter(layers, heads number of attention, embedding shape, etc.) in different model settings.
                    The total stage of PPL curves are present in Figure 6.
                    Compared to the baseline, our Pop-Diffuseq (green curve) converges faster, has lower PPL in the stable phase, and overfits later.
                    The PPL curves of all settings in the stable phase are shown in the Figure 7.
                    Pop-Diffuseq maintains the steady(variance<0.237) lowest value and is 55.89% lower than the average value of the baseline DiffuSeq (purple curve) over 8 valid recording points.
                    On the contrary, DiffuSeq is unstable(variance>13 in converge phase) and fluctuates greatly throughout the training process.
                    The DiffuSeq with la-attention(red curve) are lower than baseline DiffuSeq, indicating that la-attention can improve the fitting of model but is still unstable.
                    The multi-head output module and modified objective function are helpful for the Pop-Diffuseq.
                    In fact, we first reproduced the decoder-based SymphonyNet with linear transformer (same layers, heads and embedding shape, etc.) and MMR method, but their Loss and PPL metrics could not converge to a suitable interval in accompaniment task.
                </p>
                <div class="container">
                    <img src="picture/ppl01.jpg" alt="ppl01" width="30%" height="30%">
                </div>
                <p style="text-align:center;font-size:20px">Figure 6. PPL curve for total stage. The lower the PPL index, the better.</p>
                <div class="container">
                    <img src="picture/ppl02.jpg" alt="ppl02" width="30%" height="30%">
                </div>
                <p style="text-align:center;font-size:20px">Figure 7. PPL curves of all settings in the stable phase. The lower the PPL index, the better.</p>


    <p style="font-size:20px;">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(B) Objective evaluation for symbolic music. Figure 8-17 shows the pitch class transition matrix (PCTM), pitch classes histogram,
        average duration and onset interval for generated and reference instruments on test data set.
        Reference instrument means the human created music in test data set.
        The result shows that our POP-diffuseq correctly produces musical content under the requirements of instrumental prompts,
        and the generated content has both the characteristics of instruments and the richness of AI.
    </p>
    <div class="container">
    <img src="picture/objective_eval_our_01.png" alt="objective_eval_01" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 8. Objective evaluation for generated and reference guitar.
        <br>The generated guitar are present by our model.</p>
    <br>

    <div class="container">
    <img src="picture/objective_eval_AMT_guitar_01.png" alt="objective_eval_01" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 9. Objective evaluation for generated and reference guitar.
        <br>The generated guitar are present by AMT model.</p>
    <br>
        <div class="container">
    <img src="picture/objective_eval_our_02.png" alt="objective_eval_02" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 10. Objective evaluation for generated and reference piano.
        <br>The generated piano are present by Our model.</p>
    <br>
    <div class="container">
    <img src="picture/objective_eval_AMT_piano_02.png" alt="objective_eval_02" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 11. Objective evaluation for generated and reference piano.
        <br>The generated piano are present by AMT model.</p>
    <br>

    <p style="font-size:20px;">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Figures 8 to 11 show two groups of comparative tests.
        Two models are compared, one is our model (Pop-diffuseq) and the other is the latest SOTA model AMT which is published in the Transactions on Machine Learning Research, 2024.
        They are both trained and evaluated on the LMD dataset.
        The generated and reference samples of AMT are obtained by the official Colab Notebook: https://johnthickstun.com/anticipation/
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Figures 8 and 9 are a pair of guitar tests. Figure 10 and 11 are piano tests.
        Regarding PTCM, Pop-diffuseq is competent for more complex content,
        and the images of generated PTCM are richer for AMT, indicating the richness of our model.
        Both models can learn the characteristics of the instrument because the shape of the generated PTCMs are equivalent to the references.
        For pitch classes histogram, average duration and onset interval,
        the more similar the generated histogram is to the reference, the better.
        The Pop-diffuseq model handles the characteristics of musical instruments better.
    </p>

        <div class="container">
    <img src="picture/objective_eval_our_03.png" alt="objective_eval_03" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 12. Objective evaluation for generated and reference strings.</p>
    <br>
        <div class="container">
    <img src="picture/objective_eval_our_04.png" alt="objective_eval_04" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 13. Objective evaluation for generated and reference organ.</p>
    <br>
        <div class="container">
    <img src="picture/objective_eval_our_05.png" alt="objective_eval_05" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 14. Objective evaluation for generated and reference ensemble.</p>
    <br>
    <div class="container">
    <img src="picture/objective_eval_our_06.png" alt="objective_eval_06" width="50%" height="50%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 15. Objective evaluation for generated and reference reed.</p>
    <br>
        <div class="container">
    <img src="picture/objective_eval_our_07.png" alt="objective_eval_07" width="40%" height="40%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 16. The pitch class transition matrix for 3 sets of bass.</p>
    <br>
        <div class="container">
    <img src="picture/objective_eval_our_08.png" alt="objective_eval_08" width="90%" height="90%">
    </div>
    <p style="text-align:center;font-size:20px">Figure 17. The pitch classes histogram, average duration and onset interval for 3 sets of bass.</p>
    <p style="font-size:20px;">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Figures 12 to 17 present various samples of musical instruments created by our model.
        They are randomly selected, not hand-picked, and you can reproduce them using our public code and platform.
        These images show that our model can well mimic the characteristics of human-composed musical scores, which is of great value for commercial applications.
    </p>

    <h2>In the end</h2>
                <p style="font-size:26px;">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thank you so much for reading this, and thank you for your time and patience!
                    <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Wishing you all the best in 2025!
                    <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Happy New Year!

    </p>


			</section>
		</article>
	</main>

</div>

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-139981676-1', 'auto');
	ga('send', 'pageview');
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script type="text/x-mathjax-config">
     MathJax.Hub.Config({
         HTML: ["input/TeX","output/HTML-CSS"],
         TeX: {
                Macros: {
                         bm: ["\\boldsymbol{#1}", 1],
                         argmax: ["\\mathop{\\rm arg\\,max}\\limits"],
                         argmin: ["\\mathop{\\rm arg\\,min}\\limits"]},
                extensions: ["AMSmath.js","AMSsymbols.js"],
                equationNumbers: { autoNumber: "AMS" } },
         extensions: ["tex2jax.js"],
         jax: ["input/TeX","output/HTML-CSS"],
         tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true },
         "HTML-CSS": { availableFonts: ["TeX"],
                       linebreaks: { automatic: true } }
     });
 </script>

 <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       tex2jax: {
         skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
       }
     });
 </script>

 <script type="text/javascript" async
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML">
 </script>




</body>
</html>
